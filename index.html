<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TARIFUL 2.0 - Pro Player</title>

<style>
/* Purono style gulo thakbe... */
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
body{background:#1a110f;color:#efdbd5}

.section{display:none;padding:15px}
#playerBox{background:#000;border-radius:15px;overflow:hidden;margin-bottom:15px}
video{width:100%;max-height:50vh;transition: 0.3s;}

/* Audio Mode Style */
.audio-mode video {
    height: 0px; /* Video lukiye fela hobe */
    opacity: 0;
}
.audio-visualizer {
    display: none;
    height: 100px;
    text-align: center;
    line-height: 100px;
    background: #2a1f1d;
    font-weight: bold;
    color: #d0ffda;
}
.audio-mode .audio-visualizer { display: block; }

.controls{display:flex;justify-content:center;gap:10px;padding:15px;background:#2a1f1d}
.btn-ctrl{background:#352d2b;color:white;border:none;width:50px;height:50px;border-radius:50%;cursor:pointer}

/* Toggle Switch */
.mode-switch {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #2a1f1d;
    padding: 10px 15px;
    border-radius: 12px;
    margin-bottom: 10px;
}
</style>
</head>

<body>

<div id="videoSec" class="section" style="display:block">
    <div class="header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h3 style="color:#d0ffda">TARIFUL Pro Player</h3>
    </div>

    <div id="playerContainer">
        <div id="playerBox">
            <div class="audio-visualizer">üéµ Audio Mode Active</div>
            <video id="mainMedia" playsinline></video>
            
            <div class="mode-switch">
                <span>Play as Audio Only</span>
                <input type="checkbox" id="audioToggle" onchange="toggleAudioMode()">
            </div>

            <div class="controls">
                <button class="btn-ctrl" onclick="prev()">‚èÆ</button>
                <button class="btn-ctrl" onclick="togglePlay()" id="pBtn">‚ñ∂</button>
                <button class="btn-ctrl" onclick="next()">‚è≠</button>
                <button class="btn-ctrl" onclick="toggleLoop()" id="lBtn">üîÅ</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" multiple accept="video/*,audio/*" onchange="handleFiles(event)">
    <div id="videoList"></div>
</div>

<script>
let queue = [];
let currentIdx = 0;
const media = document.getElementById("mainMedia");

function handleFiles(e) {
    queue = Array.from(e.target.files);
    play(0);
}

function toggleAudioMode() {
    const isAudioOnly = document.getElementById("audioToggle").checked;
    if(isAudioOnly) {
        document.getElementById("playerBox").classList.add("audio-mode");
    } else {
        document.getElementById("playerBox").classList.remove("audio-mode");
    }
}

function play(index) {
    if (index < 0 || index >= queue.length) return;
    currentIdx = index;
    const url = URL.createObjectURL(queue[index]);
    media.src = url;
    
    // Media Session API: Jeta app close korle-o background-e audio dhore rakhe
    if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
            title: queue[index].name,
            artist: 'Tariful Player',
            album: 'Background Play Active'
        });

        // Background Controls
        navigator.mediaSession.setActionHandler('play', () => media.play());
        navigator.mediaSession.setActionHandler('pause', () => media.pause());
        navigator.mediaSession.setActionHandler('previoustrack', () => prev());
        navigator.mediaSession.setActionHandler('nexttrack', () => next());
    }

    media.play();
    document.getElementById("pBtn").innerText = "‚è∏";
}

function togglePlay() {
    media.paused ? (media.play(), document.getElementById("pBtn").innerText = "‚è∏") : (media.pause(), document.getElementById("pBtn").innerText = "‚ñ∂");
}

function next() { if (currentIdx < queue.length - 1) play(currentIdx + 1); else play(0); }
function prev() { if (currentIdx > 0) play(currentIdx - 1); }

/* --- Background Optimization --- */
document.addEventListener("visibilitychange", function() {
    // App minimize korle-o jate bondho na hoy
    if (document.hidden && !media.paused) {
        media.play(); 
    }
});

// Video end hole auto next
media.onended = () => next();
</script>

</body>
</html>
