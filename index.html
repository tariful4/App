<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TARIFUL2.0</title>
    <style>
        /* ‡¶Æ‡ßÇ‡¶≤ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #1a110f; color: #efdbd5; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

        /* ‡¶Ö‡¶•‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¨‡¶ï‡ßç‡¶∏ */
        .auth-box { background: #2a1f1d; padding: 30px; border-radius: 25px; width: 90%; max-width: 360px; text-align: center; border: 1px solid #3e2e2a; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .auth-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #553f38; background: #1a110f; color: white; outline: none; }
        .auth-btn { width: 100%; padding: 15px; background: #8b442d; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; }
        
        /* ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        #dashboard { text-align: center; width: 100%; max-width: 360px; display: none; }
        .menu-card { 
            background: #2a1f1d; padding: 25px; margin: 15px 0; border-radius: 20px; 
            border: 1px solid #3e2e2a; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; justify-content: space-between;
        }
        .menu-card:hover { transform: translateY(-5px); background: #352825; border-color: #8b442d; }
        .menu-card h3 { color: #f7e3a0; font-size: 1.3rem; }
        .menu-icon { font-size: 1.8rem; }

        /* ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞ ‡¶ì ‡¶®‡ßã‡¶ü‡¶¨‡ßÅ‡¶ï ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        #mainApp { width: 100%; max-width: 400px; padding: 20px; display: none; }
        .screen { height: 120px; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-end; padding: 20px; font-size: 2.5rem; color: white; overflow: hidden; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn { height: 70px; width: 70px; border: none; border-radius: 50%; font-size: 1.4rem; cursor: pointer; }
        .num { background: #352d2b; color: white; }
        .op { background: #4a3a37; color: #f7e3a0; }
        .ac { background: #7c3a25; color: white; }
        .eq { background: #f7e3a0; color: #3e2e00; border-radius: 35px; }

        /* ‡¶®‡ßã‡¶ü‡¶¨‡ßÅ‡¶ï ‡¶á‡¶®‡¶™‡ßÅ‡¶ü */
        .note-area { width: 100%; height: 150px; background: #2a1f1d; border: 1px solid #3e2e2a; border-radius: 15px; padding: 15px; color: white; margin-bottom: 15px; resize: none; outline: none; }
        .nav-btn { background: #352d2b; color: white; border: none; padding: 8px 15px; border-radius: 15px; margin-bottom: 15px; cursor: pointer; }
        
        #historyPanel, #notesDisplay { margin-top: 20px; max-height: 200px; overflow-y: auto; text-align: left; }
        .data-item { padding: 10px; border-bottom: 1px solid #3e2e2a; color: #bcaea9; font-size: 0.85rem; }
    </style>
</head>
<body>

<div id="authSection">
    <div class="auth-box">
        <h2 id="authTitle" style="margin-bottom: 20px;">TARIFUL 2.0</h2>
        <input type="text" id="userInput" class="auth-input" placeholder="Username">
        <input type="password" id="passInput" class="auth-input" placeholder="Password">
        <button class="auth-btn" id="submitBtn">Login</button>
        <p onclick="toggleAuth()" id="toggleMsg" style="color:#f7e3a0; margin-top:15px; cursor:pointer; font-size:0.9rem;">New User? Register here</p>
    </div>
</div>

<div id="dashboard">
    <h2 style="margin-bottom: 10px;">Welcome, <span id="displayUser" style="color:#f7e3a0;">User</span></h2>
    <p style="color:#bcaea9; margin-bottom: 30px;">Choose a Service</p>
    
    <div class="menu-card" onclick="showApp('calcSec')">
        <div>
            <h3>Calculator</h3>
            <p style="font-size: 0.8rem; color:#bcaea9;">Cloud Sync History</p>
        </div>
        <div class="menu-icon">üßÆ</div>
    </div>

    <div class="menu-card" onclick="showApp('noteSec')">
        <div>
            <h3>Note Book</h3>
            <p style="font-size: 0.8rem; color:#bcaea9;">Safe & Private Notes</p>
        </div>
        <div class="menu-icon">üìù</div>
    </div>

    <button onclick="location.reload()" style="margin-top:30px; background:none; border:none; color:#7c3a25; cursor:pointer; font-weight:bold;">LOGOUT</button>
</div>

<div id="mainApp">
    <div id="calcSec" style="display:none;">
        <button onclick="backToDash()" class="nav-btn">‚Üê Back to Menu</button>
        <div class="screen" id="disp">0</div>
        <div class="grid">
            <button class="btn ac" onclick="clr()">AC</button>
            <button class="btn op" onclick="add('(')">(</button>
            <button class="btn op" onclick="add(')')">)</button>
            <button class="btn op" onclick="add('/')">√∑</button>
            <button class="btn num" onclick="add('7')">7</button>
            <button class="btn num" onclick="add('8')">8</button>
            <button class="btn num" onclick="add('9')">9</button>
            <button class="btn op" onclick="add('*')">√ó</button>
            <button class="btn num" onclick="add('1')">1</button>
            <button class="btn num" onclick="add('2')">2</button>
            <button class="btn num" onclick="add('3')">3</button>
            <button class="btn op" onclick="add('+')">+</button>
            <button class="btn num" onclick="add('0')">0</button>
            <button class="btn num" onclick="add('.')">.</button>
            <button class="btn num" onclick="bk()">‚å´</button>
            <button class="btn eq" onclick="runCalc()">=</button>
        </div>
        <div id="historyPanel">
            <p style="color:#f7e3a0; font-size:0.7rem; margin-bottom:5px;">RECENT CLOUD HISTORY</p>
            <div id="histList"></div>
        </div>
    </div>

    <div id="noteSec" style="display:none;">
        <button onclick="backToDash()" class="nav-btn">‚Üê Back to Menu</button>
        <textarea id="noteInput" class="note-area" placeholder="Write your note here..."></textarea>
        <button onclick="saveNote()" class="auth-btn" id="noteSaveBtn">Save Note</button>
        <div id="notesDisplay">
            <p style="color:#f7e3a0; font-size:0.7rem; margin:15px 0 5px 0;">YOUR SAVED NOTES</p>
            <div id="notesList"></div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶®‡¶§‡ßÅ‡¶® Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC4fFgrOTrv24U7oei22yT_PzV8ZH-3UC4",
      authDomain: "my-database-23e85.firebaseapp.com",
      projectId: "my-database-23e85",
      storageBucket: "my-database-23e85.firebasestorage.app",
      messagingSenderId: "617226662362",
      appId: "1:617226662362:web:ef0e72eedcb6808e4d90e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUsername = "";
    let isLoginMode = true;

    window.toggleAuth = () => {
        isLoginMode = !isLoginMode;
        document.getElementById("authTitle").innerText = isLoginMode ? "TARIFUL 2.0" : "Create Account";
        document.getElementById("submitBtn").innerText = isLoginMode ? "Login" : "Register";
        document.getElementById("toggleMsg").innerText = isLoginMode ? "New User? Register here" : "Already have an account? Login";
    };

    document.getElementById("submitBtn").onclick = async () => {
        const user = document.getElementById("userInput").value.trim().toUpperCase();
        const pass = document.getElementById("passInput").value.trim();
        if(!user || !pass) return alert("Fill all fields");

        const userRef = doc(db, "users", user);
        const snap = await getDoc(userRef);

        if(isLoginMode) {
            if(snap.exists() && snap.data().password === pass) {
                currentUsername = user;
                startApp();
            } else alert("Wrong Password/User!");
        } else {
            if(snap.exists()) alert("User already exists!");
            else {
                await setDoc(userRef, { password: pass, history: [], notes: [] });
                alert("Account Created! Now Login.");
                toggleAuth();
            }
        }
    };

    function startApp() {
        document.getElementById("authSection").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("displayUser").innerText = currentUsername;
        loadCloudData();
    }

    window.showApp = (id) => {
        document.getElementById("dashboard").style.display = "none";
        document.getElementById("mainApp").style.display = "block";
        document.getElementById("calcSec").style.display = (id === 'calcSec') ? 'block' : 'none';
        document.getElementById("noteSec").style.display = (id === 'noteSec') ? 'block' : 'none';
    };

    window.backToDash = () => {
        document.getElementById("mainApp").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
    };

    window.saveToCloud = async (log) => {
        if(!currentUsername) return;
        await updateDoc(doc(db, "users", currentUsername), { history: arrayUnion(log) });
        loadCloudData();
    };

    window.saveNote = async () => {
        const txt = document.getElementById("noteInput").value.trim();
        if(!txt || !currentUsername) return;
        document.getElementById("noteSaveBtn").innerText = "Saving...";
        await updateDoc(doc(db, "users", currentUsername), { notes: arrayUnion(txt) });
        document.getElementById("noteInput").value = "";
        document.getElementById("noteSaveBtn").innerText = "Save Note";
        loadCloudData();
    };

    async function loadCloudData() {
        const snap = await getDoc(doc(db, "users", currentUsername));
        if(snap.exists()){
            const data = snap.data();
            document.getElementById("histList").innerHTML = (data.history || []).slice(-5).reverse().map(i => `<div class="data-item">${i}</div>`).join("");
            document.getElementById("notesList").innerHTML = (data.notes || []).slice().reverse().map(i => `<div class="data-item">üìå ${i}</div>`).join("");
        }
    }
</script>

<script>
    let d = document.getElementById("disp");
    function add(v) { d.innerText = (d.innerText === "0") ? v : d.innerText + v; }
    function clr() { d.innerText = "0"; }
    function bk() { d.innerText = d.innerText.length > 1 ? d.innerText.slice(0,-1) : "0"; }
    async function runCalc() {
        try {
            let res = eval(d.innerText.replace(/√ó/g, '*').replace(/√∑/g, '/'));
            let log = d.innerText + " = " + res;
            d.innerText = res;
            if(window.saveToCloud) window.saveToCloud(log);
        } catch { d.innerText = "Error"; }
    }
</script>

</body>
</html>
