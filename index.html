<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TARIFUL 2.0 </title>
    <style>
        :root {
            --bg-color: #1a110f;
            --card-bg: #2a1f1d;
            --text-main: #efdbd5;
            --accent: #8b442d; /* AC Button & Highlights */
            --num-btn: #3a2e2a;
            --op-btn: #4d3d39;
            --eq-btn: #e9e29c; /* Equals Button */
            --eq-text: #3e2e00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background: var(--bg-color); color: var(--text-main); display: flex; justify-content: center; min-height: 100vh; }

        /* Auth & Dashboard */
        .container { width: 100%; max-width: 400px; padding: 20px; }
        .auth-box, .dashboard-box { background: var(--card-bg); padding: 25px; border-radius: 28px; margin-top: 50px; text-align: center; border: 1px solid #3e2e2a; }
        .auth-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 1px solid #553f38; background: #1a110f; color: white; outline: none; }
        .btn-primary { width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* Calculator UI (Exact Match to Screenshot) */
        #calcSec { display: none; }
        .calc-header { display: flex; justify-content: space-between; padding: 10px; color: #bcaea9; }
        .screen { height: 180px; display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-end; padding: 20px; font-size: 3.5rem; color: white; word-break: break-all; }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 10px; }
        .btn { height: 80px; width: 80px; border: none; border-radius: 50%; font-size: 1.6rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .btn:active { opacity: 0.7; }
        
        .btn-ac { background: #7c3a25; color: #ffdbcf; font-weight: 500; }
        .btn-op { background: var(--op-btn); color: #efdbd5; }
        .btn-num { background: var(--num-btn); color: #efdbd5; }
        .btn-eq { background: var(--eq-btn); color: var(--eq-text); border-radius: 40px; }

        /* History & Notebook Item Style */
        .list-item { background: #251a17; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #3e2e2a; }
        .item-actions button { background: none; border: none; color: #f7e3a0; margin-left: 10px; cursor: pointer; font-size: 0.9rem; }
        .del-btn { color: #ff8a80 !important; }

        /* Notebook */
        .note-area { width: 100%; height: 150px; background: #2a1f1d; border: 1px solid #3e2e2a; border-radius: 20px; padding: 15px; color: white; margin-bottom: 15px; resize: none; font-size: 1rem; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="authSection" class="auth-box">
        <h2 id="authTitle">TARIFUL 2.0</h2>
        <input type="text" id="userInput" class="auth-input" placeholder="Username">
        <input type="password" id="passInput" class="auth-input" placeholder="Password">
        <button class="btn-primary" id="submitBtn">Login</button>
        <p onclick="toggleAuth()" id="toggleMsg" style="color:#f7e3a0; margin-top:15px; cursor:pointer;">New User? Register</p>
    </div>

    <div id="dashboard" class="hidden">
        <div class="dashboard-box">
            <h3>Welcome, <span id="displayUser" style="color:#f7e3a0;">User</span></h3>
            <button class="btn-primary" onclick="showApp('calcSec')">Open Calculator</button>
            <button class="btn-primary" onclick="showApp('noteSec')" style="background:#4d3d39;">Open Note Book</button>
            <button onclick="location.reload()" style="margin-top:20px; background:none; border:none; color:#7c3a25; cursor:pointer;">Logout</button>
        </div>
    </div>

    <div id="calcSec">
        <div class="calc-header">
            <span onclick="backToDash()" style="cursor:pointer">âœ•</span>
            <span onclick="toggleHistory()">ðŸ•’ History</span>
        </div>
        <div class="screen" id="disp">0</div>
        <div class="grid">
            <button class="btn btn-ac" onclick="clr()">AC</button>
            <button class="btn btn-op" onclick="add('(')">( )</button>
            <button class="btn btn-op" onclick="add('%')">%</button>
            <button class="btn btn-op" onclick="add('/')">Ã·</button>
            
            <button class="btn btn-num" onclick="add('7')">7</button>
            <button class="btn btn-num" onclick="add('8')">8</button>
            <button class="btn btn-num" onclick="add('9')">9</button>
            <button class="btn btn-op" onclick="add('*')">Ã—</button>
            
            <button class="btn btn-num" onclick="add('4')">4</button>
            <button class="btn btn-num" onclick="add('5')">5</button>
            <button class="btn btn-num" onclick="add('6')">6</button>
            <button class="btn btn-op" onclick="add('-')">âˆ’</button>
            
            <button class="btn btn-num" onclick="add('1')">1</button>
            <button class="btn btn-num" onclick="add('2')">2</button>
            <button class="btn btn-num" onclick="add('3')">3</button>
            <button class="btn btn-op" onclick="add('+')">+</button>
            
            <button class="btn btn-num" onclick="add('0')">0</button>
            <button class="btn btn-num" onclick="add('.')">.</button>
            <button class="btn btn-num" onclick="bk()">âŒ«</button>
            <button class="btn btn-eq" onclick="runCalc()">=</button>
        </div>
        <div id="historyPanel" class="hidden" style="margin-top:20px;">
            <h4>History</h4>
            <div id="histList"></div>
        </div>
    </div>

    <div id="noteSec" class="hidden">
        <div class="calc-header"><span onclick="backToDash()" style="cursor:pointer">âœ• Back</span></div>
        <textarea id="noteInput" class="note-area" placeholder="Write something..."></textarea>
        <button id="saveNoteBtn" class="btn-primary" onclick="saveNote()">Save Note</button>
        <div id="notesList" style="margin-top:20px;"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC4fFgrOTrv24U7oei22yT_PzV8ZH-3UC4",
      authDomain: "my-database-23e85.firebaseapp.com",
      projectId: "my-database-23e85",
      storageBucket: "my-database-23e85.firebasestorage.app",
      messagingSenderId: "617226662362",
      appId: "1:617226662362:web:ef0e72eedcb6808e4d90e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUser = "";
    let isLogin = true;
    let editIndex = -1;

    // --- Auth Logic ---
    window.toggleAuth = () => {
        isLogin = !isLogin;
        document.getElementById("authTitle").innerText = isLogin ? "TARIFUL 2.0" : "Register";
        document.getElementById("submitBtn").innerText = isLogin ? "Login" : "Create";
    };

    document.getElementById("submitBtn").onclick = async () => {
        const u = document.getElementById("userInput").value.toUpperCase();
        const p = document.getElementById("passInput").value;
        if(!u || !p) return;

        const ref = doc(db, "users", u);
        const snap = await getDoc(ref);

        if(isLogin) {
            if(snap.exists() && snap.data().password === p) {
                currentUser = u;
                goDashboard();
            } else alert("Invalid credentials!");
        } else {
            await setDoc(ref, { password: p, history: [], notes: [] });
            alert("Registered!"); toggleAuth();
        }
    };

    function goDashboard() {
        document.getElementById("authSection").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        document.getElementById("displayUser").innerText = currentUser;
        fetchData();
    }

    window.showApp = (id) => {
        document.getElementById("dashboard").classList.add("hidden");
        document.getElementById(id).style.display = "block";
    };

    window.backToDash = () => {
        document.getElementById("calcSec").style.display = "none";
        document.getElementById("noteSec").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
    };

    // --- Cloud Data Operations ---
    async function fetchData() {
        const snap = await getDoc(doc(db, "users", currentUser));
        const data = snap.data();
        
        // Render History
        document.getElementById("histList").innerHTML = data.history.map((h, i) => `
            <div class="list-item">
                <span>${h}</span>
                <div class="item-actions">
                    <button class="del-btn" onclick="deleteItem('history', ${i})">Delete</button>
                </div>
            </div>
        `).join("");

        // Render Notes
        document.getElementById("notesList").innerHTML = data.notes.map((n, i) => `
            <div class="list-item">
                <span style="flex:1">${n}</span>
                <div class="item-actions">
                    <button onclick="editNote(${i}, '${n}')">Edit</button>
                    <button class="del-btn" onclick="deleteItem('notes', ${i})">Del</button>
                </div>
            </div>
        `).join("");
    }

    window.saveNote = async () => {
        const val = document.getElementById("noteInput").value;
        const snap = await getDoc(doc(db, "users", currentUser));
        let notes = snap.data().notes || [];

        if(editIndex > -1) {
            notes[editIndex] = val;
            editIndex = -1;
            document.getElementById("saveNoteBtn").innerText = "Save Note";
        } else {
            notes.push(val);
        }

        await updateDoc(doc(db, "users", currentUser), { notes });
        document.getElementById("noteInput").value = "";
        fetchData();
    };

    window.editNote = (index, text) => {
        document.getElementById("noteInput").value = text;
        editIndex = index;
        document.getElementById("saveNoteBtn").innerText = "Update Note";
    };

    window.deleteItem = async (type, index) => {
        const snap = await getDoc(doc(db, "users", currentUser));
        let list = snap.data()[type];
        list.splice(index, 1);
        await updateDoc(doc(db, "users", currentUser), { [type]: list });
        fetchData();
    };

    window.saveCalcHistory = async (res) => {
        const snap = await getDoc(doc(db, "users", currentUser));
        let history = snap.data().history || [];
        history.unshift(res);
        if(history.length > 20) history.pop();
        await updateDoc(doc(db, "users", currentUser), { history });
        fetchData();
    };
</script>

<script>
    // --- Calculator Logic ---
    let disp = document.getElementById("disp");
    function add(v) { 
        if(disp.innerText === "0") disp.innerText = v;
        else disp.innerText += v;
    }
    function clr() { disp.innerText = "0"; }
    function bk() { 
        disp.innerText = disp.innerText.length > 1 ? disp.innerText.slice(0, -1) : "0"; 
    }
    function runCalc() {
        try {
            let expr = disp.innerText.replace(/Ã·/g, '/').replace(/Ã—/g, '*');
            let result = eval(expr);
            let fullLog = disp.innerText + " = " + result;
            disp.innerText = result;
            if(window.saveCalcHistory) window.saveCalcHistory(fullLog);
        } catch { disp.innerText = "Error"; }
    }
    function toggleHistory() {
        let p = document.getElementById("historyPanel");
        p.classList.toggle("hidden");
    }
</script>

</body>
</html>
